\subsection{Walrasian Budgets}
We have already defined the economic-affordability constraint of consumers, if we also limit consumption bundle $x$ to be non-negative, we would have the Walrasian, or competitive budget:

\begin{definition}
    The Walrasian, or competitive budget set $$B_{\mathbf{p},w}=\{x\in\mathbb{R}^L_+:\mathbf{p}\cdot\mathbf{x}\leq w\}$$ is the set of all feasible consumption bundles give market prices $\mathbf{p}$ and wealth $w$.
\end{definition}

From a Walrasian budget's point of view, a consumer can only choose a consumption bundle $x$ from $B_{\mathbf{p},w}$. An underlining assumption here is $w>0$, otherwise consumers cannot afford anything. We can also
separately define the "edge" of a Walrasian budget set as:
\begin{definition}
    The \textit{budget hyperplane} is the set $\{x\in\mathbb{R}^L_+:\mathbf{p}\cdot\mathbf{x}=w\}$
\end{definition}
It determines the upper bound of the budget set: with prices of other commodities ($\mathbf{p}_{-i}$) and wealth level $w$ fixed, the change of commodity $i$'s price $p_i$ will enlarge/shrink the budget set by moving the budget hyperplane.
Geometrically, the price vector $\mathbf{p}$ must be orthogonal to the budget hyperplane, we can think it this way: for any two bundles $\mathbf{x}$ and $\mathbf{x}'$ one the budget hyperplane, we must have $\mathbf{p}\cdot\mathbf{x}=\mathbf{p}\cdot\mathbf{x}'=w$, hence
$\mathbf{p}\cdot\Delta\mathbf{x}=\mathbf{p}\cdot(\mathbf{x}'-\mathbf{x})=0$ is always true.

A core feature of the Walrasian budget set is that it is \textbf{convex}: $\forall \mathbf{x},\mathbf{y}\in B_{\mathbf{p},w}, \alpha\in[0,1], \alpha\mathbf{x}+(1-\alpha)\mathbf{y}\in B_{\mathbf{p},w}$. This is very easy to prove: $\mathbf{x}\in\mathbb{R}^L_+\land\mathbf{y}\in\mathbb{R}^L_+\Rightarrow \alpha\mathbf{x}+(1-\alpha)\mathbf{y}\in \mathbb{R}^L_+$, $\mathbf{p}\cdot\mathbf{x}\leq w\land\mathbf{p}\cdot \mathbf{y}\leq w\Rightarrow \alpha(\mathbf{p}\cdot\mathbf{x})+(1-\alpha)(\mathbf{p}\cdot\mathbf{y})\leq w$.
Notice that the Walrasian budget set is not automatically convex. Its convexity is induced from the convexity of its superset (the consumption set), in this case $\mathbb{R}^L_+$. In general, it is easy to show that the Walrasian budget set will convex as long as its corresponding consumption set is convex.

Of course, it is perfectly possible that a consumer's budget is NOT convex (and not Walrasian, in that sense), the brilliant work of \citet{deaton1980economics} has documented and discussed many complicated consumption sets that are not convex.

\subsection{Walrasian Demand Function}
With Walrasian budgets defined, we can define \textit{Walrasian demand correspondence} and \textit{Walrasian demand function} as:
\begin{definition}
    For each \textit{price-wealth} pair $(\mathbf{p},w)$, Walrasian demand correspondence is the set of chosen consumption bundles, written as $\mathbf{x}(\mathbf{p},w)$. When $\mathbf{x}(\mathbf{p},w)$ is single-valued, it will be referred to as a \textbf{Walrasian demand function}.
\end{definition}

The two main assumptions of $\mathbf{x}(\mathbf{p},w)$ are:
\begin{definition}
    For a Walrasian demand correspondence $\mathbf{x}(\mathbf{p},w)$, we assume it is:
    \begin{enumerate}
        \item[1.] \textbf{Homogeneous of degree zero}: $\forall \mathbf{p},w$ and $\alpha >0$, $\mathbf{x}(\alpha \mathbf{p},\alpha w)=\mathbf{x}(\mathbf{p},w)$. This means that if wealth and prices change in the same proportion at the same time, consumer would not change her choice. 
        
        There are two implications of homogeneous of degree zero assumption:
        \begin{enumerate}
            \item[-] \textbf{Dimension reduction}: With this assumption, we can reduce $\mathbf{x}(\mathbf{p},w)$ to $\mathbf{x}(\tilde{\mathbf{p}},1)$ where $\tilde{\mathbf{p}}=\frac{1}{w}\mathbf{p}$, hence to a $L$-argument problem.
            \item[-] \textbf{Choice structure}: By homogeneity of degree zero, $\mathbf{x}(\mathbf{p},w)$ depends only on $\mathbf{p}$ and $w$, i.e. the budget set, then for the family of Walrasian budget sets $\mathcal{B}^*=\{B_{\mathbf{p},w}:\mathbf{p}\gg 0,w>0\}$, $(\mathcal{B}^*,\mathbf{x}(\cdot))$ is a choice structure. This choice structure does NOT include all possible subsets of $X$\sidenotes{$\leftarrow X$ is the set of all possible bundles}, in particular, not all two- and three-element subsets of $X$\footnote{This relates to the argument that when one consumption bundle $\mathbf{x^*}$ is infeasible, it not being chosen does NOT mean it is less preferred. This will be dealt with more carefully with more assumptions of preference-based demand.}, therefore, requires more assumptions to have a rationalizing preference.
        \end{enumerate}
             
        \item[2.] \textbf{Walras' law}: $\forall \gg 0,w>0$, $\mathbf{p}\cdot\mathbf{x}=w$ for every $\mathbf{x}\in \mathbf{x}(\mathbf{p},w)$. Walras' law means that a consumer want to spend all her wealth for consumption, every consumption bundle hence will exhaust $w$. Walras' law implies that goods are continuous.
        
        Notice that this is implicitly intertemporal, meaning that Walras' law consider lifetime resource allocation.
    \end{enumerate}
\end{definition}

Next, we disucess several basic definitions induced from the Walrasian demand function. For a demand function 
$$\mathbf{x}(\mathbf{p},w)=\left[x_1 (\mathbf{p},w),x_2 (\mathbf{p},w),\cdots, x_L(\mathbf{p},w) \right]^T$$ we have the following two effects:

\begin{description}
    \item[Wealth effects] \underline{Fix $\mathbf{p}$, get a function of $x(w)$}.
    
    Take the partial derivative of demand function on wealth: $$D_w x(\mathbf{x},w)=\left[\frac{\partial x_1(\mathbf{p},w)}{\partial w}, \frac{\partial x_2(\mathbf{p},w)}{\partial w},\cdots, \frac{\partial x_L(\mathbf{p},w)}{\partial w} \right]^T$$, then $\frac{\partial x_l(\mathbf{p},w)}{\partial w}$ is the \textit{wealth effect} for the $l$th commodity.
    Wealth effects can classify commodities into two types:
    \begin{enumerate}
        \item[-] \textbf{normal}: $\partial x_l(\mathbf{p},w)/\partial w\geq 0$
        \item[-] \textbf{inferior}: $\partial x_l(\mathbf{p},w)/\partial w <0$
    \end{enumerate} 
    \item[Price effects] \underline{For commodity $l$, fix $\mathbf{p}_{-l}$ and $w$, get a function of $x(p_l)$}.
    
    Take the partial derivative of demand function on price vector:
    $$D_{\mathbf{p}}x(\mathbf{p},w)= \begin{bmatrix}
        \nabla_{\mathbf{p}}x_1(\mathbf{p},w)\\
        \vdots\\
        \nabla_{\mathbf{p}}x_L(\mathbf{p},w) \end{bmatrix} 
    =
    \begin{bmatrix}
        \frac{\partial x_1(\mathbf{p},w)}{\partial p_1} & \cdots & \frac{\partial x_1(\mathbf{p},w)}{\partial p_L}\\
        \vdots & \ddots & \vdots\\
        \frac{\partial x_L(\mathbf{p},w)}{\partial p_1} & \cdots &\frac{\partial x_L(\mathbf{p},w)}{\partial p_L}
        \end{bmatrix}$$
\end{description}

For most goods, the price effects would be negative: you would buy more if the price is lower. However, there \textit{Giffen} goods (often low quality) and \textit{Veblen} goods (often luxurious) that have positive price effects.

Regarding wealth effects $\partial x_l(\mathbf{p},w)/partial w$ and price effects $\partial x_l(\mathbf{p},w)/\partial p_k$, we have the following two theorems:

\begin{theorem}\label{thm_homo_waldemand_thm1}
    If the Walrasian demand function $\mathbf{x}(\mathbf{p},w)$ is \textbf{homogeneous of degree zero}, the $\forall \mathbf{p},w$:
    $$\sum^L_{k=1}\frac{\partial x_l(\mathbf{p},w)}{\partial p_k}p_k +\frac{\partial x_l(\mathbf{p},w)}{\partial w}w=0,\forall l=1,\cdots,L$$
\end{theorem}

This is easy to proof: homogeneity of degree zero gives $\mathbf{x}(\alpha \mathbf{p},\alpha w)-\mathbf{x}(\mathbf{p},w)=0$, differentiating with respect to $\alpha$, get:
$$D_{\alpha \mathbf{p}}\mathbf{x}(\alpha \mathbf{p},\alpha w)\cdot \mathbf{p} + D_{\alpha w} \mathbf{x}(\alpha \mathbf{p},\alpha w)w=0$$
this is true for any $\alpha$, if we take $\alpha=1$, we get $D_{\mathbf{p}}\mathbf{x}(\mathbf{p}, w)\cdot \mathbf{p} + D_{ w} \mathbf{x}( \mathbf{p}, w)w=\mathbf{0}$, which is just the matrix notation of Thm.\ref{thm_homo_waldemand_thm1}.

Intuitively, this implies the price (substitution) effects and wealth (income) effects induced by the price change of one commodity, when weighted by the prices of other commodities and wealth, will cancel out.

Another theorem is induced from Walras' law:
\begin{theorem}\label{thm_walraslaw_waldemand_thm2}
    If the Walrasian demand function $\mathbf{x}(\mathbf{p},w)$ satisfies \textbf{Walras' law}, then for all $\mathbf{p},w$:
    $$\sum^L_{l=1}p_l\frac{\partial x_l(\mathbf{p},w)}{\partial p_k}+x_k(\mathbf{p},w)=0,\forall k=1,\cdots,L$$
    and
    $$\sum^L_{l=1}p_l\frac{\partial x_l(\mathbf{p},w)}{\partial w}=1$$
\end{theorem}

The proof is also easy: Walras' law gives $\mathbf{p}\cdot \mathbf{x}(\mathbf{p},w)=w$, take derivatives with respect to $\mathbf{p}$, get $\mathbf{p}\cdot D_{\mathbf{p}}\mathbf{x}(\mathbf{p},w)+\mathbf{x}(\mathbf{p},w)^T=\mathbf{0}^T$; take derivatives with repsect to $w$, get $\mathbf{p}\cdot D_{w}(\mathbf{p},w)=1$. The intuition is: a change in prices do NOT change the total expenditure, and the total expenditure will change by the same amount with the change in wealth.

If we define elasticities as:
\begin{align*} 
    \epsilon_{lk}=\frac{\partial x_l(\mathbf{p},w)/x_l(\mathbf{p},w)}{\partial p_k /p_k} && \text{ \% change in demand for $l$ per \% change in the price of $k$} \\ 
    \epsilon_{lw}=\frac{\partial x_l(\mathbf{p},w)/x_l(\mathbf{p},w)}{\partial w/w} && \text{ \% change in demand for $l$ per \% change in wealth $w$}
\end{align*}

We can rewrite Thm.\ref{thm_homo_waldemand_thm1} as $\sum^L_{k=1}\epsilon_{lk}(\mathbf{p},w)+\epsilon_{lw}(\mathbf{p},w)=0$ for $l=1,\cdots,L$: this directly expresses that an equal \% change in all prices and wealth leads to no change in demand, i.e., the homogeneity of degree zero.
And we can rewrite the two equations in Thm.\ref{thm_walraslaw_waldemand_thm2} as $\sum^L_{l=1}\frac{p_lx_l(\mathbf{p},w)}{w}\epsilon_{lk}(\mathbf{p},w)+\frac{p_kx_k(\mathbf{p},w)}{w}=0$ for $k=1,\cdots,L$ and $\sum^L_{l=1}\frac{p_lx_l(\mathbf{p},w)}{w}\epsilon_{lw}(\mathbf{p},w)=1$.

\subsection{WARP and Law of Demand}
Since for the family of Walrasian budget sets $\mathcal{B}^*=\{B_{\mathbf{p},w}:\mathbf{p}\gg 0,w>0\}$, $(\mathcal{B}^*,\mathbf{p}(\cdot))$ is a choice structure, naturally, we would like to check when WARP holds for this choice structure.

\begin{definition}\label{def_walrasian_WARP}
    A Walrasian demand function $\mathbf{x}(\mathbf{p},w)$ satisfies WARP if any two price-wealth conditions $(\mathbf{p},w)$ and $(\mathbf{p}',w')$ satisfies:
    $$\mathbf{p}\cdot \mathbf{x}(\mathbf{p}',w')\leq w\text{ and }\mathbf{x}(\mathbf{p}',w')\neq \mathbf{x}(\mathbf{p},w)\Rightarrow \mathbf{p}'\cdot\mathbf{x}(\mathbf{p},w)>w'$$
\end{definition}

The intuition is quite straightforward: If $\mathbf{p}\cdot \mathbf{x}(\mathbf{p}',w')\leq w$ and $\mathbf{x}(\mathbf{p}',w')\neq \mathbf{x}(\mathbf{p},w)$, the consumer chooses $\mathbf{x}(\mathbf{p},w)$ even when $\mathbf{x}(\mathbf{p}',w')$ is affordable. Hence, $\mathbf{x}(\mathbf{p},w)$ is preferred over $\mathbf{x}(\mathbf{p}',w')$, which means that the only reason why she chooses $\mathbf{x}(\mathbf{p},w)$ instead of $\mathbf{x}(\mathbf{p}',w')$ is that she can not afford $\mathbf{x}(\mathbf{p},w)$ at $(\mathbf{p}',w')$, i.e. $\mathbf{p}'\mathbf{x}(\mathbf{p},w)>w'$. An easier way to understand WARP is that we \textbf{CANNOT} have both $\mathbf{p}'\cdot \mathbf{x}(\mathbf{p},w)\leq w'$ and $\mathbf{p}\cdot \mathbf{x}(\mathbf{p}',w')\leq w$, unless $\mathbf{x}(\mathbf{p}',w')=\mathbf{x}(\mathbf{p},w)$.

It is easy to show that this definition is a special case of Def.\ref{def_WARP}: here we consider single-valued $C(\cdot)$ (function), then Def.\ref{def_WARP} gives that $\forall B,B'$ and $x,y\in B\cap B'$, $x=C(B),y=C(B')\Rightarrow x\in C(B')\Rightarrow x=y$. Rewrite this in the context of Walrasian demand functions, we have: for any $(\mathbf{p},w),(\mathbf{p}',w')$, if $\mathbf{p}\cdot\mathbf{x}(\mathbf{p}',w')\leq w$ and $\mathbf{p}'\cdot \mathbf{x}(\mathbf{p},w)\leq w'$, then $\mathbf{x}(\mathbf{p},w)=\mathbf{x}(\mathbf{p'},w')$. This is the contrapositive statement of Def.\ref{def_walrasian_WARP}. Hence the two definitions are equivalent.

\subsubsection*{WARP and compensated price changes}
WARP can also be stated in terms of compensated price changes. At $(\mathbf{p},w)$, the consumer chooses $\mathbf{x}(\mathbf{p},w)$, if she still want to afford $\mathbf{x}(\mathbf{p},w)$ at a new price $\mathbf{p}'$, she would need to adjust her wealth to $w'=\mathbf{p}'\cdot \mathbf{x}(\mathbf{p},w)$, this gives \textit{Slutsky wealth compensation} $\Delta w=w'-w=\Delta \mathbf{p}\cdot\mathbf{x}(\mathbf{p},w)=(\mathbf{p}'-\mathbf{p})\mathbf{x}(\mathbf{p},w)$, $\Delta \mathbf{p}$ is referred to as \textit{compensated price changes}. With these concepts defined, WARP implies:
\begin{theorem}\label{thm_WARP_to_lawofdemand}
    For any $\Delta \mathbf{p}$ from initial situation $(\mathbf{p},w)$ to $(\mathbf{p}',w')=(\mathbf{p}',\mathbf{p}'\cdot(\mathbf{x},w))$, if WARP holds, we have
    $$(\mathbf{p}'-\mathbf{p})\cdot[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]\leq 0$$
    with strict inequality unless $\mathbf{x}(\mathbf{p},w)=\mathbf{x}(\mathbf{p}',w')$.
\end{theorem}

Here is a proof: rewrite the left-side, get
$$(\mathbf{p}'-\mathbf{p})\cdot[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]=\mathbf{p}'\cdot[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]-\mathbf{p}\cdot[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]$$
By Walras' law, $\mathbf{p}'\cdot\mathbf{x}(\mathbf{p}',w')=w'$, $\mathbf{p}\cdot \mathbf{x}(\mathbf{p},w)=w$, also by assumption of compensated price changes, $\mathbf{p}'\cdot\mathbf{x}(\mathbf{p},w)=w'$, if if WARP holds, since $\mathbf{x}(\mathbf{p},w)$ is affordable at $(\mathbf{p}',w')$, $\mathbf{x}(\mathbf{p}',w')$ must NOT be affordable at $(\mathbf{p},w)$, i.e., $\mathbf{p}\cdot \mathbf{x}(\mathbf{p}',w')>w$, therefore, we have:
$$(\mathbf{p}'-\mathbf{p})\cdot[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]= \underbrace{\mathbf{p}'\cdot[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]}_{=0} - \underbrace{\mathbf{p}\cdot[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]}_{>0}<0$$

This Theorem goes both way, that is
\begin{theorem}\label{thm_lawofdemand_to_WARP}
    If for any compensated price changes, $(\mathbf{p}'-\mathbf{p})\cdot[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]\leq 0$ holds, the WARP is satisfied.
\end{theorem}
We proof the contrapositive: if WARP is violated, there exists a compensated price change such that $(\mathbf{p}'-\mathbf{p})\cdot[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]>0$. A violation of WARP gives that for $(\mathbf{p},w)$ and $(\mathbf{\mathbf{p}',w'})$ such that $\mathbf{x}(\mathbf{p},w)\neq \mathbf{x}(\mathbf{p}',w')$, $\mathbf{p}'\cdot \mathbf{x}(\mathbf{p},w)\leq w'$ and $\mathbf{p}\cdot \mathbf{x}(\mathbf{p}',w')\leq w$ can both be satisfied. The proof is done in 2 steps:
\begin{description}
    \item[Step 1] Prove the fact that: 
    
    If any two price-wealth pairs $(\mathbf{p},w),(\mathbf{p}',w')$, $\mathbf{p}\cdot\mathbf{x}(\mathbf{p}',w')=w,\mathbf{x}(\mathbf{p}',w')\neq \mathbf{x}(\mathbf{p},w)\Rightarrow \mathbf{p}'\cdot \mathbf{x}(\mathbf{p},w)>w'$, then WARP holds. 
    
    Again, we prove the contrapositive of this proposition: If WARP is violated, there exists a compensated price change violating WARP. Let $(\mathbf{p}',w')$ and $(\mathbf{p}'',w'')$ violates WARP such that $\mathbf{x}(\mathbf{p}',w')\neq \mathbf{x}(\mathbf{p}'',w''),\mathbf{p}'\cdot\mathbf{x}(\mathbf{p}'',w'')\leq w'$ and $\mathbf{p}''\cdot\mathbf{x}(\mathbf{p}',w')\leq w''$. We have two scenarios:
    \begin{enumerate}
        \item[-] $\mathbf{p}'\cdot\mathbf{x}(\mathbf{p}'',w'')= w'$ or $\mathbf{p}''\cdot\mathbf{x}(\mathbf{p}',w')= w''$ or both: It is easy to show that the condition of the price-wealth pairs are violated.
        \item[-] $\mathbf{p}'\cdot\mathbf{x}(\mathbf{p}'',w'')> w'$ and $\mathbf{p}''\cdot\mathbf{x}(\mathbf{p}',w')>w''$: we can construct a price-wealth pair $(\mathbf{p},w)$ such that both $\mathbf{x}(\mathbf{p}',x')$ and $\mathbf{x}(\mathbf{p}'',x'')$ are affordable. By picking an $\alpha \in (0,1)$ to linearly combine $p'$ and $p''$, we can have:
        $$(\alpha \mathbf{p}'+(1-\alpha)\mathbf{p}'')\cdot \mathbf{x}(\mathbf{p}',w')= (\alpha \mathbf{p}'+(1-\alpha)\mathbf{p}'')\cdot \mathbf{x}(\mathbf{p}'',w'')$$
        let $\mathbf{p}=\alpha \mathbf{p}'+(1-\alpha)\mathbf{p}''$, $w=(\alpha \mathbf{p}'+(1-\alpha)\mathbf{p}'')\cdot \mathbf{x}(\mathbf{p}',w')$\footnote{Why this construction works? Since $A = \mathbf{p}'\cdot \mathbf{x}(\mathbf{p}',w')= w'> \mathbf{p}'\cdot \mathbf{x}(\mathbf{p}'',w'')=A'$, $B=\mathbf{p}''\cdot \mathbf{x}(\mathbf{p}',w')<w''= \mathbf{p}''\cdot \mathbf{x}(\mathbf{p}'',w'')=B'$, therefore if $\alpha$ is properly chosen, we can achieve $\alpha A+(1-\alpha)B = \alpha A'+(1-\alpha) B'$ with $A>A',B<B'$.}.
         Now, both $\mathbf{x}(\mathbf{p},w)$ and $\mathbf{x}'(\mathbf{p}',w')$ are on the constructed budget line $(\mathbf{p},w)$. It is easy to show that
        \begin{align*}
            \alpha w'+(1-\alpha)w'' &> \alpha \mathbf{p}'\cdot\mathbf{x}(\mathbf{p}',w')+(1-\alpha) \mathbf{p}''\cdot \mathbf{x}(\mathbf{p}',w') \\
            & = w=\mathbf{p}\cdot \mathbf{x}(\mathbf{p},w)\\
            & = \left[ \alpha \mathbf{p}+(1-\alpha) \mathbf{p}''\right]\cdot \mathbf{x}(\mathbf{p},w)
        \end{align*}
        hence, either $\mathbf{p}'\cdot \mathbf{x}(\mathbf{p},w)<w'$ or $\mathbf{p}''\cdot \mathbf{x}(\mathbf{p},w)<w''$. If $\mathbf{p}'\cdot\mathbf{x}(\mathbf{p},w)<w'$, we know $\mathbf{x}(\mathbf{p}',w')$ is on the constructed line $(\mathbf{p},w)$, therefore, $\mathbf{p}\cdot \mathbf{x}(\mathbf{p}',w')=w$. However, we already have $\mathbf{p}'\cdot \mathbf{x}(\mathbf{p},w)<w'$, the two conditions constitute a violation of WARP.
    \end{enumerate} 

    Now we know, we can only consider compensated price changes to test WARP, we can move to Step 2.
    \item[Step 2] With Step 1 done, we know that if WARP does NOT hold, there exists a compensated price change from $(\mathbf{p}',w')$ to $(\mathbf{p},w)$ such that $\mathbf{x}(\mathbf{p},w)\neq \mathbf{x}(\mathbf{p}',w')$, $\mathbf{p}\cdot \mathbf{x}(\mathbf{p}',w')=w$ and $\mathbf{p'}\cdot (\mathbf{p},w)\leq w'$. 
    Meanwhile, Walras' law gives $w= \mathbf{p}\cdot\mathbf{x}(\mathbf{p},w),w'=\mathbf{p}'\cdot\mathbf{x}(\mathbf{p}',w')$, leading to 
    $$\mathbf{p}\cdot\left[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)\right]=0,\ \mathbf{p}'\cdot\left[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)\right]\geq 0$$
    Hence, combined with the condition $\mathbf{x}(\mathbf{p},w)\neq \mathbf{x}(\mathbf{p}',w')$, we have
    $$(\mathbf{p}'-\mathbf{p})\cdot\left[\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)\right]> 0$$ 
\end{description}
Now we have completed the prove of the contrapositive of Thm.\ref{thm_lawofdemand_to_WARP}.

Notice that so far, we have only linked WARP to \textbf{compensated} price changes, which means that we are focusing on the case that the budget line rotates through one point (not the end point) $\mathbf{x}(\mathbf{p},w)$ from $(\mathbf{p},w)$ to $(\mathbf{p}',w')$. A brilliant graphic presentation can be found in Figure 2.F.4 on \citet[Page 33]{mas1995microeconomic}: after a compensated price change, WARP requires that the demand for the commodity that experiences a price drop must increase, which is exactly the law of demand:
\begin{theorem}\label{thm_compensated_lawofdemand}
    For a compensated price change from $\mathbf{p}$ to $\mathbf{p}'$ (wealth changing accordingly from $w$ to $w'$ s.t. $\mathbf{p}'\mathbf{x}(\mathbf{p},w)=w'$), the law of demand requires demand and price move in opposite directions, i.e.
    $$\Delta \mathbf{x}\cdot \Delta \mathbf{p} = (\mathbf{p}'-\mathbf{p})\cdot [\mathbf{x}(\mathbf{p}',w')-\mathbf{x}(\mathbf{p},w)]\leq 0$$
\end{theorem}

And of course, if the price changes are NOT compensated, meaning that wealth does NOT change accordingly, in this case \citep[Figure 2.F.5, Page 33]{mas1995microeconomic}, the new budget line would be either completely above the original one (more generous) or completetly below (less generous), and WARP would impose NO restrictions on the new consumption bundle.

\subsection{Slutsky Matrix}
When consumer demand $\mathbf{x}(\mathbf{p},w)$ is differentiable with respect to both prices and wealth, we can rewrite the inequality in Thm.\ref{thm_compensated_lawofdemand}: $\diff \mathbf{p}\cdot \diff \mathbf{x}\leq 0$. In the spirit of compensated price changes, we know the change in wealth related to $\diff \mathbf{p}$ is $\diff w=\mathbf{x}(\mathbf{p},w)\cdot \diff \mathbf{p}$.
Use the chain rule, we can get
$$\diff \mathbf{x}= \mdiff_{\mathbf{p}}\mathbf{x}(\mathbf{p},w)\diff \mathbf{p} + \mdiff_w \mathbf{x}(\mathbf{p},w)\diff w$$
and we can plug in the induced wealth difference $\diff w=\mathbf{x}(\mathbf{p},w)\diff \mathbf{p}$, get
\begin{align*}
    \diff \mathbf{x} & = \mdiff_{\mathbf{p}}\mathbf{x}(\mathbf{p},w)\diff \mathbf{p} + \mdiff_w \mathbf{x}(\mathbf{p},w) \cdot \left[\mathbf{x}(\mathbf{p},w)\diff \mathbf{p}\right]\\
    & =\left[ \mdiff_{\mathbf{p}}\mathbf{x}(\mathbf{p},w) + \mdiff_w \mathbf{x}(\mathbf{p},w)\mathbf{x}(\mathbf{p},w)^T\right] \diff \mathbf{p}
\end{align*}
and, plug this back into the law of demand $ \diff \mathbf{p}\cdot \diff \mathbf{x}\leq 0$, we will have a very important expression:
$$
\diff \mathbf{p} \underbrace{\left[ \mdiff_{\mathbf{p}}\mathbf{x}(\mathbf{p},w) + \mdiff_w \mathbf{x}(\mathbf{p},w)\mathbf{x}(\mathbf{p},w)^T\right]}_{\equiv \mathbf{S}(\mathbf{p},w)} \diff \mathbf{p}\leq 0
$$
where $\mathbf{S}(\mathbf{p},w)$ is the \textbf{Slutsky} matrix, or \textit{substitution} matrix. 

To write it explicitly:
$$
S(\mathbf{p},w)=
\begin{bmatrix}
    s_{11}(\mathbf{p},w) & \cdots & s_{1L}(\mathbf{p},w)\\
    \vdots & \ddots & \vdots \\
    s_{L1}(\mathbf{p},w) & \cdots & s_{LL}(\mathbf{p},w)
\end{bmatrix}
$$
where $$s_{lk}(\mathbf{p},w)=\underbrace{\frac{\partial x_l(\mathbf{p},w)}{\partial p_k}}_{\text{direct effect of }\diff p_k} +\underbrace{\frac{\partial x_l (p,w)}{\partial w}x_k(\mathbf{p},w)}_{\text{effect through wealth compensation due to }\diff p_k}$$
This term measures the differential change in $x_l$ (consumption of $l$) due to a differential change in $p_k$ (the price of $k$), when wealth is adjusted so that the consumer can still afford the pre-change consumption bundle. We can interpret the two sub-terms as:
\begin{enumerate}
    \item[-] $\frac{\partial x_l(\mathbf{p},w)}{\partial p_k}$: the change in demand for $l$ due to the change of $k$'s price is $\frac{\partial x_l(\mathbf{p},w)}{\partial p_k}\diff p_k$
    \item[-] $\frac{\partial x_l (p,w)}{\partial w}x_k(\mathbf{p},w)$: the wealth change that makes the consumer able to just afford the original consumption bundle is $x_k(\mathbf{p},w)\diff p_k$, the effect of this wealth change on the demand for $l$ is $\frac{\partial x_l (p,w)}{\partial w}x_k(\mathbf{p},w)\diff p_k$
\end{enumerate}
In short, the price change of $k$ influences the demand of $l$ in 2 ways: directly (through partial derivatives) and indirectly (through wealth compensation). Slutsky matrix documents this influence, i.e., \textbf{substitution effect}, for each possible pair of goods. 

Here, we have the core feature of Slutsky matrix: 
\begin{theorem}
    If a differentiable Walrasian demand function $\mathbf{x}(\mathbf{p},w)$ satisfies Walras' law, homogeneity of degree 0, and the weak axiom, then at any $(\mathbf{p},w)$, $S(\mathbf{p},w)$ satisfies
    $$\mathbf{v}\cdot S(\mathbf{p},w)\mathbf{v}\leq 0, \forall \mathbf{v}\in\mathbb{R}^L$$
    i.e., Slutsky matrix is negative semidefinite\footnote{Notice that "semidefnite" is an abbreviation, in fact, Slutsky is not required to be symmetric here. Symmetry of $S(\mathbf{p},w)$ has more meanings later. See }.
\end{theorem}

There are several implications worth noticing:
\begin{theorem} If $S(\mathbf{p},w)$ is negative semidefinite, then
    \begin{enumerate}
        \item[(a)] $s_{ll}(\mathbf{p},w)\leq 0$: the \textit{substitution effect} of good $l$ with respect to its own price is always \textbf{non-positive}.
        \item[(b)] Giffen good must be inferior: $s_{ll}(\mathbf{p},w)=\frac{\partial x_l(\mathbf{p},w)}{\partial p_l}+\frac{\partial x_l(\mathbf{p},w)}{\partial w}x_l(\mathbf{p},w)\leq 0$, then it is easy to see that at $(\mathbf{p},w)$, $\frac{\partial x_l(\mathbf{p},w)}{\partial p_l}>0\Rightarrow \frac{\partial x_l(\mathbf{p},w)}{\partial w}<0$.
        \item[(c)] If $\mathbf{x}(\mathbf{p},w)$ is differentiable, homogeneous of degree 0 and satisfies Walras' law, then $\forall (\mathbf{p},w), \mathbf{p}\cdot S(\mathbf{p},w)=0, S(\mathbf{p},w)\mathbf{p}=0$. This means that $S(\mathbf{p},w)$ is always singular (its rank is less than $L$).
        
        It is easy to prove:

        Thm.\ref{thm_walraslaw_waldemand_thm2} gives $\mathbf{p}\cdot S(\mathbf{p},w)=\mathbf{p}\cdot \mdiff_{\mathbf{p}}\mathbf{x}(\mathbf{p},w)+\mathbf{p}\cdot \mdiff_w \mathbf{x}(\mathbf{p},w)\mathbf{x}(\mathbf{p},w)^T =\mathbf{p}\mdiff_{\mathbf{p}}\mathbf{x}(\mathbf{p},w)+\mathbf{x}(\mathbf{p},w)^T=0$;
        Thm.\ref{thm_homo_waldemand_thm1} gives $S(\mathbf{p},w)\mathbf{p}=\mdiff_{\mathbf{p}}\mathbf{x}(\mathbf{p},w)\mathbf{p}+\mdiff_w\mathbf{x}(\mathbf{p},w)\mathbf{x}(\mathbf{p},w)^T\mathbf{p}=\mdiff_{\mathbf{p}}\mathbf{x}(\mathbf{p},w)\mathbf{p}+\mdiff_w\mathbf{x}(\mathbf{p},w)w=0$.
    \end{enumerate}
\end{theorem}

Finally, we can have a little discussion on WARP and the negative semidefiniteness of the Slutsky matrix.

\begin{enumerate}
    \item[-] WARP $\Rightarrow$ the Slutsky matrix being negative semidefinite.
    
    The Slutsky matrix is constructed from WARP and compensated law of demand $\mathrm{d}\mathbf{x}\cdot \mathrm{d}\mathbf{p}\leq 0$, hence WARP implying semi-definite Slutsky matrices is vacuous.

    \item[-] the Slutsky matrix being negative semidefinite $\not\Rightarrow$ WARP
    
    Negative semidefiniteness of the Slutsky matrix itself is NOT sufficient for WARP,
    
\end{enumerate}

For the 5 conditions:
    \begin{enumerate}
        \item[(1)] \textbf{WARP}: $\mathbf{p}\cdot \mathbf{x}(\mathbf{p}',w')\leq w\text{ and }\mathbf{x}(\mathbf{p}',w')\neq \mathbf{x}(\mathbf{p},w)\Rightarrow \mathbf{p}'\cdot\mathbf{x}(\mathbf{p},w)>w'$
        \item[(2)] \textbf{WWARP} (weaker WARP): $\mathbf{p}\cdot \mathbf{x}(\mathbf{p}',w')< w\text{ and }\mathbf{x}(\mathbf{p}',w')\neq \mathbf{x}(\mathbf{p},w)\Rightarrow \mathbf{p}'\cdot\mathbf{x}(\mathbf{p},w)>w'$
        \item[(3)] Slutsky matrix being \textbf{negative semidefinite} (NSD): $\mathbf{v}\cdot S(\mathbf{p},w)\mathbf{v}\leq 0, \forall \mathbf{v}\in\mathbb{R}^L$
        \item[(4)] Slutsky matrix being \textbf{negative definite} (ND): $\mathbf{v}\cdot S(\mathbf{p},w)\mathbf{v}< 0, \forall \mathbf{v}\in\mathbb{R}^L$
        \item[(5)] Slutksy matrix being \textbf{symmetric} 
    \end{enumerate}

    they have the following relations:
    \begin{enumerate}
        \item[-] \textbf{WWARP} $\Rightarrow$ Slutsky matrix is NSD 
    \end{enumerate}
    
    This is discussed rather thoroughly by \citet{kihlstrom1976demand}.