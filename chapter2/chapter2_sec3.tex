\subsection{Properties of Preferences Required}
To analyze demand with preferences (and later, utility), we first need some assumptions on preferences $\succsim$:

\paragraph*{$\succsim$ is rational}
\begin{enumerate}
    \item[-] \textbf{completeness}: $\forall \mathbf{x},\mathbf{y}\in X$, it must be either $\mathbf{x}\succsim \mathbf{y}$ or $\mathbf{y}\succsim \mathbf{x}$ or both
    \item[-] \textbf{transitivity}: $\forall \mathbf{x},\mathbf{y},\mathbf{z} \in X$ $\mathbf{x} \succsim \mathbf{y},\mathbf{y}\succsim \mathbf{z}\Rightarrow \mathbf{x}\succsim \mathbf{z}$ 
\end{enumerate}

\paragraph*{$\succsim$ is desirable}
It is reasonable to assume that larger amounts of commodities are preferred. So basically, the more the better.

Here, we have two common assumption, a stronger one, and a weaker one:
\begin{enumerate}
    \item[-] \textbf{monotone} (\textit{stronger}): if $\textbf{x},\textbf{y}\in X$, $\textbf{y}\gg \textbf{x}\Rightarrow \textbf{y}\succ \textbf{x}$
    
    \textbf{strongly monotone} (\textit{even stronger}): if $\textbf{x},\textbf{y}\in X$, $\textbf{y}\geq \textbf{x}$ and $\textbf{y}\neq \textbf{x}\Rightarrow \textbf{y}\succ \textbf{x}$
    \item[-] \textbf{locally nonsatiated} (\textit{weaker}): $\forall \mathbf{x} \in X, \forall \varepsilon >0$, $\exists \mathbf{y}\in X$ s.t. $\left\Vert \mathbf{y}-\mathbf{x} \right\Vert \leq \varepsilon$ and $\mathbf{y}\succ \mathbf{x}$
\end{enumerate}
Local nonsatiation is the common used one, since it poses minimal constraints. It is easy to see that \textbf{strongly monotone} $\Rightarrow$ \textbf{monotone} $\Rightarrow$ \textbf{locally nonsatiated}, here is a proof:
If $\succsim$ is strongly monotone and $\mathbf{x} \gg \mathbf{y}$, then $\mathbf{x}\geq \mathbf{y}$ and $\mathbf{x}\neq \mathbf{y}$ and $x\succ y$, thus $\succsim$ is monotone; 
if $\succsim$ is monotone, $\mathbf{x}\in X$ and $\varepsilon>0$, let $\mathbf{y}=\mathbf{x}+\frac{\varepsilon}{\sqrt{L}}\mathbf{e}$ where $\mathbf{e}=(1,\cdots,1)\in \mathbb{R}^L$, then $\left\Vert \mathbf{y}-\mathbf{x}\right\Vert\leq \varepsilon$ and $y\succ x$, hence $\succsim$ is locally nonsatiated.

$\succsim$ will divide $X$ into 3 sets relative to $\mathbf{x}$:
\begin{enumerate}
    \item[-] \textbf{upper contour set}: $\left\{\mathbf{y}\in X\mid \mathbf{y}\succsim \mathbf{x} \right\}$  
    \item[-] \textbf{lower contour set}: $\left\{\mathbf{y}\in X \mid \mathbf{x}\succsim \mathbf{y}\right\}$ 
    \item[-] \textbf{indifferent set}: $\left\{\mathbf{y}\in X \mid \mathbf{x}\sim \mathbf{y}\right\}$ 
\end{enumerate}
and \textbf{local nonsatiation} guarantees that the indifference set is a line.

\paragraph*{$\succsim$ is convex}
$\succsim$ is \textbf{convex} if $\forall \mathbf{x}\in X$, $\mathbf{y}\succsim\mathbf{x}$ and $\mathbf{z}\succsim\mathbf{x}$ $\Rightarrow$ $\alpha \mathbf{y}+(1-\alpha)\mathbf{z}\succsim \mathbf{x},\forall \alpha \in [0,1]$; that is, the upper contour set of $\mathbf{x}$, $\left\{\mathbf{y}\in X\mid \mathbf{y}\succsim \mathbf{x} \right\}$ is convex.

Convexity assumption is one of the central assumption, it expresses two intuitive observations of economic agents:
\begin{enumerate}
    \item[(i)] diminishing marginal rates of substitution
    \item[(ii)] inclination for diversification  
\end{enumerate}

$\succsim$ is \textbf{strictly convex} if $\forall \mathbf{x}\in X$, $\mathbf{y}\succsim\mathbf{x}$ and $\mathbf{z}\succsim\mathbf{x}$ $\Rightarrow$ $\alpha \mathbf{y}+(1-\alpha)\mathbf{z}\succ \mathbf{x},\forall \alpha \in [0,1]$.

\paragraph*{$\succsim$ is continuous}
So far, we have rationality, local nonsatiation and convexity, but these are NOT enough to guarantee a preference $\succsim$ to be representable by a utility funciton. An example is \textbf{lexicographic preference relation}.
%\begin{tcolorbox}[title = {lexicographic preference relation},colframe = black, colback = white]
%    This is my first \textbf{tcolorbox}.
%\end{tcolorbox}

The lexicographic preference relation is $\mathbf{x}\succsim \mathbf{y}\Leftrightarrow \left(x_1>y_1 \right) \lor \left( x_1=y_1 \land x_2> y_2\right) \lor \cdots \lor \left( x_1=y_1 \land \cdots x_{L-1}=y_{L-1} \land x_L\geq y_L \right)$. It is complete, transitive, strongly monotone and strictly convex; BUT, there is \textbf{NO} utility function
representing it\footnote{Here is a brief proof: Suppose there is a utility function $u(\cdot)$, then for every $x_1$, we can pick a rational number $r(x_1)$ s.t. $u(x_1,2)>r(x_1)>u(x_1,1)$, if $x_1 >x_1'$, then $r(x_1)>u(x_1,1)>u(x_1',2)>r(x_1')$. Hence $r(\cdot)$ is a one-to-one function from the set of real numbers (uncountably infinite) to the set of rational numbers (countably infinite), which is mathematically impossible. Another way of proving it is: suppose there is a utility function $u(\cdot)$, $[\inf u(x,\cdot),\sup u(x,\cdot)]$ is an interval, hence if $x<y$, $\sup u(x,\cdot)<\inf u(y,\cdot)$, which is impossible}.
To guarantee utility representability, $\succsim$ needs to be continuous: $\succsim$ is continuous if it is preserved under limits, that is, $\forall \left\{\{x^n,y^n\}\right\}^{\infty}_{n=1}$ with $x^n\succsim y^n, \forall n$, $x=\lim_{n\rightarrow\infty}x^n,y=\lim_{n\rightarrow\infty}y^n\Rightarrow x\succsim y$.

Continuity can also be expressed as: $\forall \mathbf{x}$, the upper contour set $\left\{\mathbf{y}\in X\mid \mathbf{y}\succsim \mathbf{x} \right\}$ and the lower contour set $\left\{\mathbf{y}\in X\mid \mathbf{x}\succsim \mathbf{y} \right\}$ are both \textbf{closed}. Here is the proof of this equivalence: 
\begin{enumerate}
    \item[-] continuity $\Rightarrow$ contour set closedness: $\forall \left\{y^n\right\}^{\infty}_{n=1}$, let $x^n=x,\forall n$, then if $x^n=x\succsim y^n$, by continuity, $y=\lim_{n\rightarrow \infty}y^n$, we have $x\succsim y$, hence the lower contour set is closed; the upper contour set can be proved the same way.
    \item[-] contour set closedness $\Rightarrow$ continuity: Suppose $\exists \left\{x^n\right\},\left\{y^n\right\}\in X$ s.t. $\forall n, x^n\succsim y^n$, $x^n\rightarrow x\in X, y^n\rightarrow y\in X$ and $y\succ x$. We know both $\left\{z\in X\mid y\succ z \right\}$ and $\left\{z\in X\mid z\succ x \right\}$ are open, hence $\exists N_1,N_2\in \mathbb{Z}^+$ s.t. $y\succ x^n,\forall n>N_1; y^n\succ x,\forall n>N_2$, conceivably, there are two cases on $\left\{y^n\right\}$:
    \begin{enumerate}
        \item[-] $\exists N_3 \in \mathbb{Z}^+$ s.t. $y^n\succsim y, \forall n>N_3$: then we have $y^n\succ x^n,\forall n>\max\{N_1,N_3\}$, contradiction.
        \item[-] $\exists \left\{y^{k(n)}\right\}$ s.t. $y\succ y^{k(n)},\forall n$: then $\exists m\in \mathbb{Z}^+$ s.t. $k(m)>N_2$, we know $\left\{z\in X\mid z\succ y^{k(m)}\right\}$ is open, $\exists N_4\in \mathbb{Z}^+$ s.t. $y^n\succ y^{k(m)}, \forall n>N_4$. Since $\left\{z\mid z\succsim y^{k(m)}\right\}$ is closed, $x\succsim y^{k(m)}$, however, since $k(m)>N_2$, $y^{k(m)}\succ x$ is assumed, hence contradiction.
    \end{enumerate} 
    Another way of proving this is to assume $\succsim$ to be monotone.
\end{enumerate}

\subsection{Utility representing preference}
Given the assumption of continuity, we can finally have the following thoerem:
\begin{theorem}
    If a preference relation $\succsim$ is rational and \textbf{continuous}, then there is a continuous utility function $u(x)$ that represents $\succsim$.
\end{theorem}

Here is the proof:
\begin{enumerate}
    \item[-] \underline{\textbf{continuous $u(\cdot)$ $\Rightarrow$ continuous preference}}: 
    
    suppose $\left\{x_n\right\}\rightarrow x^*,\left\{y_n\right\}\rightarrow y^*$, $u(\cdot)$ represents $\succsim$, hence $u(x_n)\geq u(y_n)$. If $u(\cdot)$ is continuous, $u(x_n)\rightarrow u(x^*),u(y_n)\rightarrow u(y^*)$, hence $u(x^*)\geq u(y^*)$, leading to $x^*\succsim y^*$.
    \item[-] \underline{\textbf{continuous preference $\Rightarrow$ continuous $u(\cdot)$}}: 
    
    The proof is done in 3 steps:
    \begin{enumerate}
        \item[Step 1] First, we construct the utility function.
        
        Since preferences are continuous, and if monotone is assumed, for each $\mathbf{x}\in \mathbb{R}^L$, define a function $\alpha(\mathbf{x}):\mathbb{R}^L\rightarrow \mathbb{R}$ such that $\alpha(\mathbf{x})=\inf\{a\mid a\cdot \mathbf{e}\succsim \mathbf{x}\}$ where $\mathbf{e}=(1,\cdots,1)^T$. By the continuity of $\succsim$, $\{a\mid a\cdot \mathbf{e}\succsim \mathbf{x}\}$ is non-empty and bounded below, hence $\inf$ exists.
        Also, continuity of $\succsim$ implies the upper contour set of $\mathbf{x}$ is closed, hence $\exists \underline{a}\in \mathbb{R}$ s.t. $\underline{a}=\inf\{a\mid a\cdot \mathbf{e}\succsim \mathbf{x}\}$. Let $\alpha(\mathbf{x})=\underline{a}$, $\alpha(\mathbf{x})\mathbf{e}\succsim \mathbf{x}$, also $x\succ (\alpha(x)-\frac{1}{n})\mathbf{e}$, by continuity, $x\succsim \alpha(\mathbf{x})$. Hence, $\mathbf{x}\sim \alpha(\mathbf{x})\mathbf{e}$\footnote{
            $\mathbf{x}\sim \alpha(\mathbf{x})\mathbf{e}$ can also be proven as: by continuity, $A^{up}=\{\alpha\in \mathbf{R}_+\mid \alpha\mathbf{e}\succsim \mathbf{x}\}$ and $A^{low}\{\alpha\in \mathbf{R}_+\mid \mathbf{x}\succsim\alpha\mathbf{e}\}$ are both non-empty and closed. By completeness of $\succsim$, $\mathbb{R}_+\subset A^{up}\cup A^{low}$; $\mathbb{R}_+$ is connected, hence $A^{up}\cap A^{low}\neq \varnothing$, thus there exists $\alpha$ s.t. $\alpha \mathbf{e}\sim \mathbf{x}$. And by monotonicity, $\alpha_1>\alpha_2\Rightarrow\alpha_1\mathbf{e}\succ \alpha_2\mathbf{e}$, hence the scalar $\alpha\mathbf{e}\sim\mathbf{x}$ is unique.
            }, then, we can take $\alpha(\mathbf{x})$ as the utility function $u(\mathbf{x})=\alpha(\mathbf{x})$.

        \item[Step 2] Next, we prove $\alpha(\mathbf{x})\geq \alpha(\mathbf{y})\Leftrightarrow \mathbf{x}\succsim\mathbf{y}$
            \begin{enumerate}
                \item[-] $\alpha(\mathbf{x})\geq \alpha(\mathbf{y})\Rightarrow \mathbf{x}\succsim\mathbf{y}$: Suppose $\alpha(\mathbf{x})\geq \alpha(\mathbf{y})$, by monotonicity, $\alpha(\mathbf{x})\mathbf{e}\succsim \alpha(\mathbf{y})\mathbf{e}$. Since $\mathbf{x}\sim \alpha(\mathbf{x})\mathbf{e},\mathbf{y}\sim\alpha(\mathbf{y})\mathbf{e}$, we have $x\succsim y$
                \item[-] $\alpha(\mathbf{x})\geq \alpha(\mathbf{y})\Leftarrow \mathbf{x}\succsim\mathbf{y}$: Suppose $\mathbf{x}\succsim \mathbf{y}$, then $\alpha(\mathbf{x})\mathbf{e}\sim\mathbf{x}\succsim \mathbf{y}\sim\alpha(\mathbf{y})\mathbf{e}$, by monotonicity, $\alpha(\mathbf{x})\geq \alpha(\mathbf{y})$
            \end{enumerate}
        
        \item[Step 3] Finally, we prove $\alpha(\mathbf{x})$ is continuous: $\lim_{n\rightarrow\infty}\mathbf{x}^n=\mathbf{x}\Rightarrow \lim_{n\rightarrow\infty}\alpha(\mathbf{x}^n)=\alpha(\mathbf{x}),\forall \{\mathbf{x}^n\}^{\infty}_{n=1}$
        \begin{enumerate}
            \item[-] $\{\alpha(\mathbf{x}^n)\}^{\infty}_{n=1}$ must have a convergent subsequence: by monotonicity, $\forall\epsilon>0$, $\forall \mathbf{x}'$ s.t. $\left\Vert\mathbf{x}'-\mathbf{x}\right\Vert\leq \epsilon$, $\alpha(\mathbf{x}')$ lies in a compact subset of $\mathbb{R}_+$, $[\alpha_0,\alpha_1]$. Since $\{\mathbf{x}^n\}^{\infty}_{n=1}$ converges to $\mathbf{x}$, then $\exists N$ s.t. $\forall n>N$, $\alpha(\mathbf{x}^n)$ lies in this compact set, hence, this infinite sequence must have a convergent subsequence.
            \item[-] all convergent subsequences of $\left\{\alpha(\mathbf{x}^n)\right\}^{\infty}_{n=1}$ converge to $\alpha(\mathbf{x})$: suppose otherwise, then there is a strictly increasing function $m(\cdot)$ that assigns to each $n$ a positive integer $m(n)$, and the subsequence $\left\{\alpha(x^{m(n)}) \right\}^{\infty}_{n=1}$ converges to $\alpha'\neq \alpha(\mathbf{x})$. Without losing generality, let $\alpha'>\alpha(\mathbf{x})$, then by monotonicity, $\alpha'\mathbf{e}\succ \alpha(\mathbf{x})\mathbf{e}$. 
            Let $\hat{\alpha}=\frac{1}{2}[\alpha'+\alpha(\mathbf{x})]$, then $\hat{\alpha}(\mathbf{e})\succ \alpha(\mathbf{x})\mathbf{e}$. Since $\alpha(\mathbf{x}^{m(n)})\rightarrow\alpha'>\hat{\alpha}$, then $\exists \bar{N}$ s.t. $\forall n>\bar{N}$, $\alpha(\mathbf{x}^{m(n)})>\hat{\alpha}$, thus $\mathbf{x}^{m(n)}\sim \alpha(\mathbf{x}^{m(n)})\mathbf{e}\succ \hat{\alpha}\mathbf{e}$. By continuity of $\succsim$, we get $\mathbf{x}\sim \alpha(\mathbf{x})\mathbf{e}\succsim \hat{\alpha}\mathbf{e}$, leading to a contradiction. 
            With the same logic, $\alpha'<\alpha(\mathbf{x})$ is ruled out as well. Hence, all convergent subsequences $\left\{\alpha(x^n)\right\}^{\infty}_{n=1}$ converge to $\alpha(\mathbf{x})$. Hence, $\lim_{n\rightarrow\infty}\alpha(\mathbf{x}^n)=\alpha(\mathbf{x})$.
        \end{enumerate}
    \end{enumerate}
\end{enumerate}

Now a continuous utility function can represent a continuous preference relation, there are several results on how they relate to each other:
\begin{enumerate}
    \item[-] continuous $u(\cdot)$ can represent $\succsim$, but any strictly increasing yet discontinuous transformation of $u(\cdot)$ may also represents $\succsim$
    \item[-] preference $\succsim$ is monotone $\Rightarrow$ utiity function $u(\cdot)$ is increasing: $\mathbf{x}\gg \mathbf{y}\Rightarrow u(\mathbf{x})>u(\mathbf{y})$ 
    \item[-] preference $\succsim$ is convex $\Rightarrow$ utility function $u(\cdot)$ is quasiconcave: the upper contour set of $\mathbf{x}$, 
    $\left\{\mathbf{y}\in\mathbb{R}^L_+\mid \mathbf{y}\succsim \mathbf{x} \right\}$ is convex $\Rightarrow$ $u(\alpha\mathbf{x}+(1-\alpha)\mathbf{y})\geq \min\{u(\mathbf{x}),u(\mathbf{y})\}$. 
    It is \textbf{quasiconcave}, NOT concave.
\end{enumerate}
Increasingness and quasiconcavity are both ordinal properties of $u(\cdot)$, preserved for any increasing transformation.

\subsection{UMP (Utility Maximizing Problem)}
A consumer's problem is to choose a feasible consumption bundle given a positive price-wealth combination $(\mathbf{p},w)$ to maximize her utility:
$$\max_{\mathbf{x}\geq 0} u(\mathbf{x}),\ \text{s.t.}\ \mathbf{p}\cdot\mathbf{x}\leq w$$
if $\mathbf{p}\gg 0$, $u(\cdot)$ is continuous, then this problem has a solution: the Walrasian budget set $B_{\mathbf{p},w}=\left\{\mathbf{x}\in\mathbb{R}^L_+\mid \mathbf{p}\cdot\mathbf{x}\leq w\right\}$ is a compact set, hence a continuous function on it always has a maximum value.

This problem will induce two objects: Walrasian demand correspondence/function $\mathbf{x}(\mathbf{p},w)\in \mathbb{R}^L_+$ and the value function $V(\mathbf{p},w)$.

\subsubsection*{$\mathbf{x}(\mathbf{p},w)$}


\subsection{EMP (Expenditure Minimizing Problem)}